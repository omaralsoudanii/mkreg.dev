---
title: 'Linux commands for me'
date: '2021-07-07'
summary: "Incremental list useful of Linux useful commands covering many tools and programs that I use when needed"
tags: ['Linux','Docker','SQL','PHP','MongoDB']
image: '/static/images/writing/linux-bin-bash/linux-bash-mkreg.jpeg'
---

## Introduction

This article is not about something specific, this is just a list of commands for various Linux programs and tools, some might be simple, others useless. Some might be great, so to clarify this list is what **I** find useful for **me**, you can look through it and who knows? maybe you'll like some of it

> The list will be incrementally changed, could be daily or maybe once a month. Every time I find something interesting or new that I actually use whether it's for a new program or a just a new command, I will add it here.

![Omar Alsoudani - Linux](/static/images/writing/linux-bin-bash/linux-bash-mkreg.jpeg)


## Table of Contents
- [General](/writing/linux-bin-bash#general)
- [Docker](/writing/linux-bin-bash#docker)
- [MySQL](/writing/linux-bin-bash#mysql)
- [MongoDB](/writing/linux-bin-bash#mongodb)
- [PHP](/writing/linux-bin-bash#php)

## General

#### Find out how many lines a file contains a phrase

```bash
cat /var/log/app.log.2 | grep "api/users" | wc -l
```

#### Curl a request with form-data uploading a file using  and get some speed info

```bash:HTTP2
curl -w '\nEstablish Connection: %{time_connect}s\nTTFB: %{time_starttransfer}s\n \
	Total: %{time_total}s\nUpload speed: %{speed_upload}s\n' \
	--http2 --location --request POST 'https://www.somedomain.com/uploadfile' \
	--header 'Authorization: Bearer HwzQAS323DvAGQ23123' --form 'file=@/home/some_file.csv' \
	--form 'file=@/home/another_file.csv'
```

This specific thing is important due to the nature of how **HTTP2** works, uploading files could be slower unless you tune your web-server **HTTP2** initial window. Try it with **HTTP1.1** and see the difference

```bash:HTTP1.1
curl -w '\nEstablish Connection: %{time_connect}s\nTTFB: %{time_starttransfer}s\n \
	Total: %{time_total}s\nUpload speed: %{speed_upload}s\n' \
	--http1.1 --location --request POST 'https://www.somedomain.com/uploadfile' \
	--header 'Authorization: Bearer HwzQAS323DvAGQ23123' --form 'file=@/home/some_file.csv' \
	--form 'file=@/home/another_file.csv'
```

You can refer to the write out command in Curl (You can find it Nuggets section too)

<Card
    title="Curl write out"
    desc="Get detailed information about a request sent through Curl using the write out option -w, which has a large range of variables that you can include in the output"
    url="https://everything.curl.dev/usingcurl/verbose/writeout/"
    icon="Curl"
/>

#### Check network speed of the host you are in

```bash
sudo ln -s /usr/bin/python3 /usr/bin/python
curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python -
```

This is very useful to get actual results about the bandwidth of say your VPS server or your home setup.

#### Check all mounted hard drives disk usage size

```bash
df -h
```

#### Check current directory disk usage size

```bash
du -sh *
```

#### Tail all incoming new lines for log file(s)

```bash
tail -f -n0 *-error_logs.log
```

#### Find if file(s) exists in the current directory/sub-directories, and list found file(s) locations

```bash
find . -name "*-logs.json" | xargs ls -lh
```

**Note:** This needs **sudo** to look in directories that requires root permission, it will also list of all files and directories in the current directory if it finds nothing, I will look into it and fix later.

#### Find if process(es) are currently running, and list process(es) details (root process/child processes) if found

```bash
ps aux | grep mysql
```

#### Start/Restart a service with a different user

```bash
sudo -u www-data service nginx start
sudo -u omar service netdata restart
```

## Docker

![Omar Alsoudani - Linux Docker](/static/images/writing/linux-bin-bash/linux-bash-docker-mkreg.jpeg)

#### Build and run a docker compose file

This builds the images and run their containers assuming the default compose file name is docker-compose.yml

```bash
docker-compose up  --build -d
```

#### Build and run docker compose file by specifying it's  file name

```bash
docker-compose  -f docker-compose.development.yml up  --build -d
```

#### Build a docker compose file with fresh start
This builds images and run their containers while ignoring the current existing images cache (useful for multi-stage builds, when you just want to re-build everything with fresh layers)

```bash
docker-compose build  --no-cache
```

#### Execute a command from a container

```bash
docker exec -it node_app npm install
```

#### Export MySQL database from a container to a directory using `mysqldump` and execute command

-    **Full database structure and data**
     
        ```bash
        docker exec -i app_mysql-server-57_1 mysqldump -uroot -proot --databases mydb_name --skip-comments > /Documents/db.sql
        ```
-    **Specified table structure and data** 
     
        ```bash
        docker exec -i app_mysql-server-57_1 mysqldump -uroot -proot mydb_name mytable_name > /Documents/db.sql
        ```
-    **Specific table structure and data that matches a where clause**
     
        ```bash
        docker exec app_mysql mysqldump -uroot -proot mydb_name --tables mytable_name --where="id>5 limit 5000000" > mytable_name.sql
        ```



#### SSH into a container using execute command

-    **For alpine images, only sh is available** 
     
        ```bash
        docker exec -it app_server sh
        ```
-    **For other images,  bash is available**
     
        ```bash
        docker exec -it app_server bash
        ```

#### Preview a docker compose file configuration found in the specified path

```bash
docker-compose -f docker-compose.development.yml config
```

#### Delete all stopped containers and unused images/networks/volumes and non persistent volumes and their networks

```bash
docker system prune -a
```
**WARNING:** Beware that all stopped containers, and unused images/networks/volumes will be deleted, so if you have something stopped but want to use it later then don't do this.

#### Delete all unused networks

```bash
docker network prune
```

#### Delete all unused volumes

```bash
docker volume ls -qf dangling=true | xargs -r docker volume rm
```

#### Tailing container logs

This gets you the latest 100 line

```bash
docker logs --tail 100 -f app_server
```

This finds lines that contains a phrase and print the containing line, 3 lines before it and 3 lines after it

```bash
docker logs -f --tail 10000  app_server | grep -B3 -A3 "api/users"
```

#### System wide information for Docker

```bash
docker system info
```

#### Docker disk usage info for the whole machine

```bash:Detailed
docker system df -v
```

<br/>


```bash:Overview
docker system df
```

## MySQL

![Omar Alsoudani - Linux MySQL](/static/images/writing/linux-bin-bash/linux-bash-mysql-mkreg.png)

#### Export MySQL database to a directory with `mysqldump`

-    **Full database structure and data** 
     
        ```bash
        mysqldump -uroot -proot --databases mydb_name --skip-comments > /Documents/db.sql
        ```
-    **Specified table structure and data** 
     
        ```bash
        mysqldump -uroot -proot mydb_name mytable_name > /Documents/db.sql
        ```
-    **A specific table structure and data that matches a where clause**
     
        ```bash
        mysqldump -uroot -proot mydb_name --tables mytable_name --where="id>5 limit 5000000" > mytable_name.sql
        ```

#### Change MySQL CLI pager to `less` 

 Using `less` helps readability when viewing large sets of data from queries in the terminal. Use this after you login into    MySQL shell

```bash
pager less -R -S
```

#### Enable and use profiling

In your current MySQL session you can enable profiling to debug and tune queries performance

```sql
SET profiling = 1;
select * from table_name where field_name like '%omar%';
SHOW PROFILES;
SHOW PROFILE FOR QUERY 1; ## 1 is the ID from SHOW PROFILES
SHOW PROFILE CPU FOR QUERY 2;
```

## MongoDB

![Omar Alsoudani - MongoDB](/static/images/writing/linux-bin-bash/linux-bash-mongodb-mkreg.jpg)

#### Show all databases

```js
show dbs
```

#### Select a databases to work on

```js
use mydb_name
```

#### Show all collections for a selected database

```js
show collections
```

#### Create a new collection in a selected database

```js
db.createCollection("collection_name")
```

#### Get all indexes for a collection

```js
db.collection_name.getIndexes()
```

#### Create a new index on a field in a collection

```js
db.collection_name.createIndex({field_name:1})
```

#### Drop an index from a field in a collection

```js
db.collection_name.dropIndex({field_name:1})
```

## PHP

![Omar Alsoudani - PHP](/static/images/writing/linux-bin-bash/linux-bash-php-mkreg.png)

> Hey Omar, how about for once in your life stop whining about **PHP**, it's just a language!
>
> Nope, I won't stop. This is my calling, now come and see the project I'm working on then say that again.
>
> This is  just a <sup>**Joke**</sup> . I love PHP and use **Laravel** (Now that's the real **joke**)

#### Run a script using specific PHP version, and passing environment variables to the script

```bash
WEBSITE=www.reddit.com ENVIROMENT=development  /usr/bin/php7.4 -f /var/www/swoole/server.php 
```

#### Enable/Disable PHP modules for a specific PHP version (needs root permission)

-    **Enable**
     
        ```bash
        sudo phpenmod -v 7.4 xdebug
        ```
-    **Disable** 
     
        ```bash
        sudo phpdismod -v 7.4 curl
        ```

#### Check the PHP settings of your installed version

```bash
php -i
php -i | grep "error_reporting"
```

In case you are using multiple PHP versions on the same machine, use ```which php``` and ```php -v``` to find the used version and its binary location